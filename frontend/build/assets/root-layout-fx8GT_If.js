import{R as u,r as d,j as e,d as y,i as le,u as ce,b as P,N as de,H as ue,w as me,O as fe,I as he,l as pe}from"./chunk-C37GKA54-qdDtUwSj.js";import{I as o}from"./declaration-kTjv-WkO.js";import"./index-CRXcsuv3.js";import{D as xe,a as U,u as Y}from"./use-settings-D0tr8qJp.js";import{u as M,a as Ee}from"./use-config-E2Ujoq47.js";import{u as J}from"./useQuery-Cjjz7Wuw.js";import{p as ee}from"./module-CT1MQcwX.js";import{O as j}from"./open-hands-DRsomnks.js";import{u as Ce}from"./use-user-providers-CrrXlKQM.js";import{L as W}from"./loading-spinner-B7_yZ5wk.js";import{c as te}from"./utils-D9IiJYms.js";import{u as f}from"./useTranslation-CSvjoMys.js";import{T as _}from"./tooltip-button-BPE9cPtP.js";import{u as se,C as ge,a as Ne,B as Ie,b as $,c as Q,M as q,d as ve}from"./conversation-card-DcZ_xgUr.js";import{S as k}from"./all-hands-logo-Cy1dOmZ-.js";import{S as Se}from"./plus-CdcK-XMD.js";import{S as _e}from"./settings-BcxdQODG.js";import{a as Ae}from"./index-DzzQAqGk.js";import{M as Te,o as Oe,H as Le,u as Me}from"./help-link-09IrHQdk.js";import{M as v}from"./modal-backdrop-CRA0KBPR.js";import{e as je}from"./settings-utils-C--CGkWg.js";import{B as I,u as G}from"./brand-button-BySt6mvX.js";import{K as we}from"./key-status-icon-Ce5TtFpp.js";import{S as be}from"./settings-input-CNdchoHE.js";import{u as Z}from"./use-save-settings-Cwt4F4PC.js";import{u as z}from"./open-hands-axios-BhCWnLeu.js";import{M as A}from"./constants-Bp2PO9HR.js";import{d as ne,a as ae}from"./custom-toast-handlers-Qj22vPIG.js";import{R as ye}from"./index-CMHnqh2J.js";import{u as Re,g as De,L as D,s as Pe,a as X}from"./use-logout-DqlpFltj.js";import{h as oe}from"./handle-capture-consent-DynBYeq8.js";import{u as Ue}from"./use-balance-BR1QT-CI.js";import{T as $e}from"./Trans-DPeFg2wd.js";import{i as ke}from"./i18next-CO45VQzB.js";import"./preload-helper-BXl3LOEh.js";import"./i18nInstance-DBIXdvxg.js";import"./chunk-BOOVDPB6-D_jh4hqk.js";import"./chunk-S6H5EOGR-CeEG5W91.js";import"./react-redux-BK5-gECc.js";import"./index-CU-dn4fA.js";import"./iconBase-DJ14kP8l.js";import"./use-conversation-id-Cpxdv6Lo.js";import"./agent-state-B-zEstf9.js";import"./vscode-url-helper-5Tt6LlE2.js";import"./ws-client-provider-dPsGJjAo.js";import"./store-Czu6Xei3.js";import"./browser-slice-DabBaamq.js";import"./query-client-config-Bf-1zXTT.js";import"./retrieve-axios-error-message-CYr77e_f.js";import"./mutation-CaKY-3Wn.js";import"./use-active-conversation-BkcNKr5c.js";import"./use-optimistic-user-message-EwrwqJBx.js";import"./map-provider-g8SgAMsv.js";import"./optional-tag-BzDrALC3.js";import"./index-DqvQQl8Z.js";const Ge=(t,n)=>{const a=`${n.hostname==="localhost"?n.protocol:"https:"}//${n.host}/oauth/keycloak/callback`;let r=n.hostname.replace(/(^|\.)staging\.all-hands\.dev$/,"$1auth.staging.all-hands.dev").replace(/(^|\.)app\.all-hands\.dev$/,"auth.app.all-hands.dev").replace(/(^|\.)localhost$/,"auth.staging.all-hands.dev");r===n.hostname&&n.hostname!=="localhost"&&(r=`auth.${n.hostname}`);const l="openid email profile",c=n.search?"&":"?",i=`${n.href.replace(/\/$/,"")}${c}login_method=${t}`;return`https://${r}/realms/allhands/protocol/openid-connect/auth?client_id=allhands&kc_idp_hint=${t}&response_type=code&redirect_uri=${encodeURIComponent(a)}&scope=${encodeURIComponent(l)}&state=${encodeURIComponent(i)}`},L=t=>t.appMode==="saas"?Ge(t.identityProvider,new URL(window.location.href)):null,Be=t=>L({appMode:t.appMode,identityProvider:"github"}),Fe=()=>{const{providers:t}=Ce(),{data:n}=M(),s=J({queryKey:["user"],queryFn:j.getGitUser,enabled:!!n?.APP_MODE&&t.length>0,retry:!1,staleTime:1e3*60*5,gcTime:1e3*60*15});return u.useEffect(()=>{s.data&&ee.identify(s.data.login,{company:s.data.company,name:s.data.name,email:s.data.email,user:s.data.login,mode:n?.APP_MODE||"oss"})},[s.data]),s},Ve=t=>d.createElement("svg",{width:27,height:26,viewBox:"0 0 27 26",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("g",{clipPath:"url(#clip0_40000158_426)"},d.createElement("path",{d:"M13.5381 1.83496C7.32618 1.83496 2.29074 6.8704 2.29074 13.0823C2.29074 19.2942 7.32618 24.3297 13.5381 24.3297C19.75 24.3297 24.7855 19.2942 24.7855 13.0823C24.7855 6.8704 19.75 1.83496 13.5381 1.83496Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M4.84641 20.22C4.84641 20.22 7.35344 17.019 13.5395 17.019C19.7255 17.019 22.2337 20.22 22.2337 20.22M13.5395 13.0824C14.4344 13.0824 15.2926 12.7269 15.9254 12.0941C16.5582 11.4613 16.9137 10.6031 16.9137 9.70819C16.9137 8.8133 16.5582 7.95505 15.9254 7.32227C15.2926 6.68948 14.4344 6.33398 13.5395 6.33398C12.6446 6.33398 11.7863 6.68948 11.1536 7.32227C10.5208 7.95505 10.1653 8.8133 10.1653 9.70819C10.1653 10.6031 10.5208 11.4613 11.1536 12.0941C11.7863 12.7269 12.6446 13.0824 13.5395 13.0824Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"})),d.createElement("defs",null,d.createElement("clipPath",{id:"clip0_40000158_426"},d.createElement("rect",{width:26,height:26,fill:"white",transform:"translate(0.5)"}))));function He({src:t}){const{t:n}=f();return e.jsx("img",{src:t,alt:n(o.AVATAR$ALT_TEXT),className:"w-full h-full rounded-full"})}function Ke({onClick:t,avatarUrl:n,isLoading:s}){const{t:a}=f();return e.jsxs(_,{testId:"user-avatar",tooltip:a(o.USER$ACCOUNT_SETTINGS),ariaLabel:a(o.USER$ACCOUNT_SETTINGS),onClick:t,className:te("w-8 h-8 rounded-full flex items-center justify-center cursor-pointer",s&&"bg-transparent"),children:[!s&&n&&e.jsx(He,{src:n}),!s&&!n&&e.jsx(Ve,{"aria-label":a(o.USER$AVATAR_PLACEHOLDER),width:28,height:28,className:"text-[#9099AC]"}),s&&e.jsx(W,{size:"small"})]})}function Ye({onLogout:t,onClose:n}){const s=se(n),{t:a}=f();return e.jsx(ge,{testId:"account-settings-context-menu",ref:s,className:"absolute right-full md:left-full -top-1 z-10 w-fit",children:e.jsx(Ne,{onClick:t,children:a(o.ACCOUNT_SETTINGS$LOGOUT)})})}function We({onLogout:t,user:n,isLoading:s}){const[a,r]=u.useState(!1),l=()=>{r(i=>!i)},c=()=>{r(!1)},h=()=>{t(),c()};return e.jsxs("div",{"data-testid":"user-actions",className:"w-8 h-8 relative cursor-pointer",children:[e.jsx(Ke,{avatarUrl:n?.avatar_url,onClick:l,isLoading:s}),a&&!!n&&e.jsx(Ye,{onLogout:h,onClose:c})]})}function Qe(){const{t}=f();return e.jsx(_,{tooltip:t(o.BRANDING$ALL_HANDS_AI),ariaLabel:t(o.BRANDING$ALL_HANDS_LOGO),navLinkTo:"/",children:e.jsx(k,{width:34,height:34})})}const Ze=t=>d.createElement("svg",{width:27,height:27,viewBox:"0 0 27 27",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M24.5719 9.17199V14.8456M15.7404 3.4984C14.9543 3.12524 14.095 2.93164 13.2248 2.93164C12.3546 2.93164 11.4952 3.12524 10.7091 3.4984L3.11671 7.05801C1.46456 7.83189 1.46456 10.5121 3.11671 11.286L10.708 14.8456C11.4943 15.2189 12.3538 15.4126 13.2242 15.4126C14.0946 15.4126 14.9541 15.2189 15.7404 14.8456L23.3328 11.286C24.985 10.5121 24.985 7.83189 23.3328 7.05801L15.7404 3.4984Z",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}),d.createElement("path",{d:"M5.28183 12.5762V18.3916C5.28183 21.7027 10.6082 23.356 13.2249 23.356C15.8415 23.356 21.1679 21.7027 21.1679 18.3916V12.5762",stroke:"currentColor",strokeWidth:1.8,strokeLinecap:"round",strokeLinejoin:"round"}));function ze({disabled:t=!1}){const{t:n}=f();return e.jsx(_,{tooltip:n(o.SIDEBAR$DOCS),ariaLabel:n(o.SIDEBAR$DOCS),href:"https://docs.all-hands.dev",disabled:t,children:e.jsx(Ze,{width:28,height:28,className:`text-[#9099AC] ${t?"opacity-50":""}`})})}function qe({disabled:t=!1}){const{t:n}=f(),s=n(o.CONVERSATION$START_NEW);return e.jsx(_,{tooltip:s,ariaLabel:s,navLinkTo:"/",testId:"new-project-button",disabled:t,children:e.jsx(Se,{width:28,height:28})})}function Xe({onClick:t,disabled:n=!1}){const{t:s}=f(),{data:a}=M(),r=a?.APP_MODE==="saas"?"/settings/user":"/settings";return e.jsx(_,{testId:"settings-button",tooltip:s(o.SETTINGS$TITLE),ariaLabel:s(o.SETTINGS$TITLE),onClick:t,navLinkTo:r,disabled:n,children:e.jsx(_e,{width:28,height:28})})}function Je({isOpen:t,onClick:n,disabled:s=!1}){const{t:a}=f();return e.jsx(_,{testId:"toggle-conversation-panel",tooltip:a(o.SIDEBAR$CONVERSATIONS),ariaLabel:a(o.SIDEBAR$CONVERSATIONS),onClick:n,disabled:s,children:e.jsx(Ae,{size:22,className:te("cursor-pointer",t?"text-white":"text-[#9099AC]",s&&"opacity-50")})})}function et({testId:t,title:n,description:s,buttons:a}){return e.jsx(Ie,{testId:t,title:n,description:s,buttons:[{text:a.danger.text,onClick:a.danger.onClick,className:"bg-danger"},{text:a.cancel.text,onClick:a.cancel.onClick,className:"bg-neutral-500"}]})}function tt({settings:t,models:n,onClose:s}){const{mutate:a}=Z(),r=y(),{t:l}=f(),c=u.useRef(null),[h,i]=u.useState(!1),p=async N=>{const E=je(N);await a(E,{onSuccess:()=>{s(),ee.capture("settings_saved",{LLM_MODEL:E.LLM_MODEL,LLM_API_KEY_SET:E.LLM_API_KEY_SET?"SET":"UNSET",SEARCH_API_KEY_SET:E.SEARCH_API_KEY?"SET":"UNSET",REMOTE_RUNTIME_RESOURCE_FACTOR:E.REMOTE_RUNTIME_RESOURCE_FACTOR})}})},C=()=>{const N=new FormData(c.current??void 0);p(N)},x=N=>{N.preventDefault();const E=new FormData(N.currentTarget);r.pathname.startsWith("/conversations/")?i(!0):p(E)},g=t.LLM_API_KEY_SET;return e.jsxs("div",{children:[e.jsxs("form",{ref:c,"data-testid":"settings-form",className:"flex flex-col gap-6",onSubmit:x,children:[e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Te,{models:Oe(n),currentModel:t.LLM_MODEL}),e.jsx(be,{testId:"llm-api-key-input",name:"llm-api-key-input",label:l(o.SETTINGS_FORM$API_KEY),type:"password",className:"w-full",placeholder:g?"<hidden>":"",startContent:g&&e.jsx(we,{isSet:g})}),e.jsx(Le,{testId:"llm-api-key-help-anchor",text:l(o.SETTINGS$DONT_KNOW_API_KEY),linkText:l(o.SETTINGS$CLICK_FOR_INSTRUCTIONS),href:"https://docs.all-hands.dev/usage/local-setup#getting-an-api-key"})]}),e.jsx("div",{className:"flex flex-col gap-2",children:e.jsx(I,{testId:"save-settings-button",type:"submit",variant:"primary",className:"w-full",children:l(o.BUTTON$SAVE)})})]}),h&&e.jsx(v,{children:e.jsx(et,{title:l(o.MODAL$END_SESSION_TITLE),description:l(o.MODAL$END_SESSION_MESSAGE),buttons:{danger:{text:l(o.BUTTON$END_SESSION),onClick:C},cancel:{text:l(o.BUTTON$CANCEL),onClick:()=>i(!1)}}})})]})}function st({onClose:t,settings:n}){const s=Me(),{t:a}=f();return e.jsx(v,{children:e.jsxs("div",{"data-testid":"ai-config-modal",className:"bg-base-secondary min-w-[384px] m-4 p-6 rounded-xl flex flex-col gap-2 border border-tertiary",children:[s.error&&e.jsx("p",{className:"text-danger text-xs",children:s.error.message}),e.jsx("span",{className:"text-xl leading-6 font-semibold -tracking-[0.01em]",children:a(o.AI_SETTINGS$TITLE)}),e.jsxs("p",{className:"text-xs text-[#A3A3A3]",children:[a(o.SETTINGS$DESCRIPTION)," ",a(o.SETTINGS$FOR_OTHER_OPTIONS),e.jsx(le,{"data-testid":"advanced-settings-link",to:"/settings",className:"underline underline-offset-2 text-white",children:a(o.SETTINGS$SEE_ADVANCED_SETTINGS)})]}),s.isLoading&&e.jsx("div",{className:"flex justify-center",children:e.jsx(W,{size:"small"})}),s.data&&e.jsx(tt,{settings:n||xe,models:s.data?.models,onClose:t})]})})}const nt=()=>{const{data:t}=U();return J({queryKey:["user","conversations"],queryFn:j.getUserConversations,enabled:!!t})},at=()=>{const t=z();return G({mutationFn:n=>j.deleteUserConversation(n.conversationId),onMutate:async n=>{await t.cancelQueries({queryKey:["user","conversations"]});const s=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],a=>a?.filter(r=>r.conversation_id!==n.conversationId)),{previousConversations:s}},onError:(n,s,a)=>{a?.previousConversations&&t.setQueryData(["user","conversations"],a.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})},ot=()=>{const t=z();return G({mutationFn:n=>j.stopConversation(n.conversationId),onMutate:async()=>(await t.cancelQueries({queryKey:["user","conversations"]}),{previousConversations:t.getQueryData(["user","conversations"])}),onError:(n,s,a)=>{a?.previousConversations&&t.setQueryData(["user","conversations"],a.previousConversations)},onSettled:()=>{t.invalidateQueries({queryKey:["user","conversations"]})}})};function rt({onConfirm:t,onCancel:n}){const{t:s}=f();return e.jsx(v,{children:e.jsxs(A,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx($,{title:s(o.CONVERSATION$CONFIRM_DELETE)}),e.jsx(Q,{description:s(o.CONVERSATION$DELETE_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:a=>a.stopPropagation(),children:[e.jsx(I,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:s(o.ACTION$CONFIRM)}),e.jsx(I,{type:"button",variant:"secondary",onClick:n,className:"w-full","data-testid":"cancel-button",children:s(o.BUTTON$CANCEL)})]})]})})}function it({onConfirm:t,onCancel:n}){const{t:s}=f();return e.jsx(v,{children:e.jsxs(A,{className:"items-start border border-tertiary",children:[e.jsxs("div",{className:"flex flex-col gap-2",children:[e.jsx($,{title:s(o.CONVERSATION$CONFIRM_STOP)}),e.jsx(Q,{description:s(o.CONVERSATION$STOP_WARNING)})]}),e.jsxs("div",{className:"flex flex-col gap-2 w-full",onClick:a=>a.stopPropagation(),children:[e.jsx(I,{type:"button",variant:"primary",onClick:t,className:"w-full","data-testid":"confirm-button",children:s(o.ACTION$CONFIRM)}),e.jsx(I,{type:"button",variant:"secondary",onClick:n,className:"w-full","data-testid":"cancel-button",children:s(o.BUTTON$CANCEL)})]})]})})}function lt({onConfirm:t,onClose:n}){const{t:s}=f();return e.jsx(v,{children:e.jsxs(A,{testID:"confirm-new-conversation-modal",children:[e.jsx($,{title:s(o.CONVERSATION$EXIT_WARNING)}),e.jsxs("div",{className:"flex w-full gap-2",children:[e.jsx(q,{text:s(o.ACTION$CONFIRM),onClick:t,className:"bg-[#C63143] flex-1"}),e.jsx(q,{text:s(o.BUTTON$CANCEL),onClick:n,className:"bg-tertiary flex-1"})]})]})})}const ct=()=>{const t=z();return G({mutationFn:n=>j.updateConversation(n.conversationId,{title:n.newTitle}),onMutate:async n=>{await t.cancelQueries({queryKey:["user","conversations"]});const s=t.getQueryData(["user","conversations"]);return t.setQueryData(["user","conversations"],a=>a?.map(r=>r.conversation_id===n.conversationId?{...r,title:n.newTitle}:r)),{previousConversations:s}},onError:(n,s,a)=>{a?.previousConversations&&t.setQueryData(["user","conversations"],a.previousConversations)},onSettled:(n,s,a)=>{t.invalidateQueries({queryKey:["user","conversations"]}),t.invalidateQueries({queryKey:["user","conversation",a.conversationId]})}})};function dt({onClose:t}){const{t:n}=f(),{conversationId:s}=ce(),a=se(t),r=P(),[l,c]=u.useState(!1),[h,i]=u.useState(!1),[p,C]=u.useState(!1),[x,g]=u.useState(null),[N,E]=u.useState(null),{data:T,isFetching:S,error:w}=nt(),{mutate:b}=at(),{mutate:B}=ot(),{mutate:F}=ct(),O=m=>{c(!0),g(m)},R=m=>{i(!0),g(m)},V=async(m,H)=>{F({conversationId:m,newTitle:H},{onSuccess:()=>{ne(n(o.CONVERSATION$TITLE_UPDATED))}})},re=()=>{x&&b({conversationId:x},{onSuccess:()=>{x===s&&r("/")}})},ie=()=>{x&&B({conversationId:x},{onSuccess:()=>{x===s&&r("/")}})};return e.jsxs("div",{ref:a,"data-testid":"conversation-panel",className:"w-[350px] h-full border border-neutral-700 bg-base-secondary rounded-xl overflow-y-auto absolute",children:[S&&e.jsx("div",{className:"w-full h-full absolute flex justify-center items-center",children:e.jsx(W,{size:"small"})}),w&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-danger",children:w.message})}),T?.length===0&&e.jsx("div",{className:"flex flex-col items-center justify-center h-full",children:e.jsx("p",{className:"text-neutral-400",children:n(o.CONVERSATION$NO_CONVERSATIONS)})}),T?.map(m=>e.jsx(de,{to:`/conversations/${m.conversation_id}`,onClick:t,children:({isActive:H})=>e.jsx(ve,{isActive:H,onDelete:()=>O(m.conversation_id),onStop:()=>R(m.conversation_id),onChangeTitle:K=>V(m.conversation_id,K),title:m.title,selectedRepository:{selected_repository:m.selected_repository,selected_branch:m.selected_branch,git_provider:m.git_provider},lastUpdatedAt:m.last_updated_at,createdAt:m.created_at,conversationStatus:m.status,conversationId:m.conversation_id,contextMenuOpen:N===m.conversation_id,onContextMenuToggle:K=>E(K?m.conversation_id:null)})},m.conversation_id)),l&&e.jsx(rt,{onConfirm:()=>{re(),c(!1)},onCancel:()=>c(!1)}),h&&e.jsx(it,{onConfirm:()=>{ie(),i(!1)},onCancel:()=>i(!1)}),p&&e.jsx(lt,{onConfirm:()=>{t()},onClose:()=>C(!1)})]})}function ut({isOpen:t,children:n}){if(!t)return null;const s=document.getElementById("root-outlet");return s?ye.createPortal(e.jsx("div",{className:"absolute h-full w-full left-0 top-0 z-20 bg-black/80 rounded-xl",children:n}),s):null}const mt=t=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:24,height:21,viewBox:"0 0 24 21",fill:"none",...t},d.createElement("path",{d:"M3 1.5C2.17157 1.5 1.5 2.17157 1.5 3V15C1.5 15.8284 2.17157 16.5 3 16.5H11.25C11.6642 16.5 12 16.8358 12 17.25C12 17.6642 11.6642 18 11.25 18H3C1.34315 18 0 16.6569 0 15V3C0 1.34315 1.34315 0 3 0H19.5C21.1569 0 22.5 1.34315 22.5 3V9C22.5 9.41421 22.1642 9.75 21.75 9.75C21.3358 9.75 21 9.41421 21 9V3C21 2.17157 20.3284 1.5 19.5 1.5H3Z",fill:"currentColor"}),d.createElement("path",{d:"M4.71967 4.71967C5.01256 4.42678 5.48744 4.42678 5.78033 4.71967L7.76517 6.7045C8.2045 7.14384 8.2045 7.85616 7.76517 8.2955L5.78033 10.2803C5.48744 10.5732 5.01256 10.5732 4.71967 10.2803C4.42678 9.98744 4.42678 9.51256 4.71967 9.21967L6.43934 7.5L4.71967 5.78033C4.42678 5.48744 4.42678 5.01256 4.71967 4.71967Z",fill:"currentColor"}),d.createElement("path",{d:"M8.25 10.5C8.25 10.0858 8.58579 9.75 9 9.75H12C12.4142 9.75 12.75 10.0858 12.75 10.5C12.75 10.9142 12.4142 11.25 12 11.25H9C8.58579 11.25 8.25 10.9142 8.25 10.5Z",fill:"currentColor"}),d.createElement("path",{d:"M24 15.75C24 18.6495 21.6495 21 18.75 21C15.8505 21 13.5 18.6495 13.5 15.75C13.5 12.8505 15.8505 10.5 18.75 10.5C21.6495 10.5 24 12.8505 24 15.75ZM18.75 12.75C18.3358 12.75 18 13.0858 18 13.5V15H16.5C16.0858 15 15.75 15.3358 15.75 15.75C15.75 16.1642 16.0858 16.5 16.5 16.5H18V18C18 18.4142 18.3358 18.75 18.75 18.75C19.1642 18.75 19.5 18.4142 19.5 18V16.5H21C21.4142 16.5 21.75 16.1642 21.75 15.75C21.75 15.3358 21.4142 15 21 15H19.5V13.5C19.5 13.0858 19.1642 12.75 18.75 12.75Z",fill:"currentColor"}));function ft({disabled:t=!1}){const{t:n}=f(),s=n(o.MICROAGENT_MANAGEMENT$TITLE);return e.jsx(_,{tooltip:s,ariaLabel:s,navLinkTo:"/microagent-management",testId:"microagent-management-button",disabled:t,children:e.jsx(mt,{})})}function ht(){const t=y(),n=Fe(),{data:s}=M(),{data:a,error:r,isError:l,isFetching:c}=Y(),{mutate:h}=Re(),[i,p]=u.useState(!1),[C,x]=u.useState(!1),g=s?.FEATURE_FLAGS.HIDE_LLM_SETTINGS&&s?.APP_MODE==="saas",N=s?.FEATURE_FLAGS.HIDE_MICROAGENT_MANAGEMENT;return u.useEffect(()=>{g||(t.pathname==="/settings"?p(!1):!c&&l&&r?.status!==404?ae("Something went wrong while fetching settings. Please reload the page."):s?.APP_MODE==="oss"&&r?.status===404&&p(!0))},[r?.status,r,c,t.pathname]),e.jsxs(e.Fragment,{children:[e.jsxs("aside",{className:"h-[40px] md:h-auto px-1 flex flex-row md:flex-col gap-1",children:[e.jsxs("nav",{className:"flex flex-row md:flex-col items-center justify-between w-full h-auto md:w-auto md:h-full",children:[e.jsxs("div",{className:"flex flex-row md:flex-col items-center gap-[26px]",children:[e.jsx("div",{className:"flex items-center justify-center",children:e.jsx(Qe,{})}),e.jsx(qe,{disabled:a?.EMAIL_VERIFIED===!1}),e.jsx(Je,{isOpen:C,onClick:()=>a?.EMAIL_VERIFIED===!1?null:x(E=>!E),disabled:a?.EMAIL_VERIFIED===!1}),!N&&e.jsx(ft,{disabled:a?.EMAIL_VERIFIED===!1})]}),e.jsxs("div",{className:"flex flex-row md:flex-col md:items-center gap-[26px] md:mb-4",children:[e.jsx(ze,{disabled:a?.EMAIL_VERIFIED===!1}),e.jsx(Xe,{disabled:a?.EMAIL_VERIFIED===!1}),e.jsx(We,{user:n.data?{avatar_url:n.data.avatar_url}:void 0,onLogout:h,isLoading:n.isFetching})]})]}),C&&e.jsx(ut,{isOpen:C,children:e.jsx(dt,{onClose:()=>x(!1)})})]}),i&&e.jsx(st,{settings:a,onClose:()=>p(!1)})]})}const pt=t=>d.createElement("svg",{width:22,height:22,viewBox:"0 0 22 22",fill:"none",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("path",{d:"M12 2.25C6.624 2.25 2.25 6.624 2.25 12C2.25 16.376 5.115 20.073 9.057 21.428C9.563 21.514 9.747 21.211 9.747 20.95C9.747 20.713 9.738 19.991 9.738 19.153C7 19.713 6.4 18.45 6.4 18.45C5.952 17.387 5.328 17.084 5.328 17.084C4.476 16.487 5.387 16.487 5.387 16.487C6.328 16.546 6.85 17.481 6.85 17.481C7.675 18.862 9.057 18.487 9.776 18.226C9.867 17.603 10.133 17.179 10.419 16.94C8.287 16.713 6.05 15.85 6.05 11.9C6.05 10.837 6.4 9.975 6.859 9.3C6.759 9.05 6.45 8.038 6.95 6.65C6.95 6.65 7.734 6.4 9.738 7.775C10.483 7.534 11.25 7.413 12.017 7.413C12.784 7.413 13.55 7.534 14.296 7.775C16.3 6.4 17.084 6.65 17.084 6.65C17.584 8.038 17.275 9.05 17.175 9.3C17.634 9.975 17.984 10.837 17.984 11.9C17.984 15.85 15.747 16.7 13.615 16.94C13.975 17.237 14.296 17.813 14.296 18.7C14.296 19.975 14.287 20.6 14.287 20.95C14.287 21.211 14.471 21.514 14.977 21.428C18.919 20.073 21.784 16.376 21.784 12C21.784 6.624 17.376 2.25 12 2.25Z",fill:"currentColor"})),xt=t=>d.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"97 99 186 182",...t},d.createElement("defs",null,d.createElement("style",null,".cls-1{fill:currentColor;}")),d.createElement("g",{id:"LOGO"},d.createElement("path",{className:"cls-1",d:"M282.83,170.73l-.27-.69-26.14-68.22a6.81,6.81,0,0,0-2.69-3.24,7,7,0,0,0-8,.43,7,7,0,0,0-2.32,3.52l-17.65,54H154.29l-17.65-54A6.86,6.86,0,0,0,134.32,99a7,7,0,0,0-8-.43,6.87,6.87,0,0,0-2.69,3.24L97.44,170l-.26.69a48.54,48.54,0,0,0,16.1,56.1l.09.07.24.17,39.82,29.82,19.7,14.91,12,9.06a8.07,8.07,0,0,0,9.76,0l12-9.06,19.7-14.91,40.06-30,.1-.08A48.56,48.56,0,0,0,282.83,170.73Z"}))),Et=t=>d.createElement("svg",{role:"img",viewBox:"0 0 24 24",xmlns:"http://www.w3.org/2000/svg",...t},d.createElement("title",null,"Bitbucket"),d.createElement("path",{d:"M.778 1.213a.768.768 0 00-.768.892l3.263 19.81c.084.5.515.868 1.022.873H19.95a.772.772 0 00.77-.646l3.27-20.03a.768.768 0 00-.768-.891zM14.52 15.53H9.522L8.17 8.466h7.561z"}));function Ct({githubAuthUrl:t,appMode:n,providersConfigured:s}){const{t:a}=f(),r=L({appMode:n||null,identityProvider:"gitlab"}),l=L({appMode:n||null,identityProvider:"bitbucket"}),c=()=>{t&&(window.location.href=t)},h=()=>{r&&(window.location.href=r)},i=()=>{l&&(window.location.href=l)},p=s&&s.length>0&&s.includes("github"),C=s&&s.length>0&&s.includes("gitlab"),x=s&&s.length>0&&s.includes("bitbucket"),g=!s||s.length===0;return e.jsx(v,{children:e.jsxs(A,{className:"border border-tertiary",children:[e.jsx(k,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:a(o.AUTH$SIGN_IN_WITH_IDENTITY_PROVIDER)})}),e.jsx("div",{className:"flex flex-col gap-3 w-full",children:g?e.jsx("div",{className:"text-center p-4 text-muted-foreground",children:a(o.AUTH$NO_PROVIDERS_CONFIGURED)}):e.jsxs(e.Fragment,{children:[p&&e.jsx(I,{type:"button",variant:"primary",onClick:c,className:"w-full",startContent:e.jsx(pt,{width:20,height:20}),children:a(o.GITHUB$CONNECT_TO_GITHUB)}),C&&e.jsx(I,{type:"button",variant:"primary",onClick:h,className:"w-full",startContent:e.jsx(xt,{width:20,height:20}),children:a(o.GITLAB$CONNECT_TO_GITLAB)}),x&&e.jsx(I,{type:"button",variant:"primary",onClick:i,className:"w-full",startContent:e.jsx(Et,{width:20,height:20}),children:a(o.BITBUCKET$CONNECT_TO_BITBUCKET)})]})}),e.jsxs("p",{className:"mt-4 text-xs text-center text-muted-foreground","data-testid":"auth-modal-terms-of-service",children:[a(o.AUTH$BY_SIGNING_UP_YOU_AGREE_TO_OUR)," ",e.jsx("a",{href:"https://www.all-hands.dev/tos",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:a(o.COMMON$TERMS_OF_SERVICE)})," ",a(o.COMMON$AND)," ",e.jsx("a",{href:"https://www.all-hands.dev/privacy",target:"_blank",className:"underline hover:text-primary",rel:"noopener noreferrer",children:a(o.COMMON$PRIVACY_POLICY)}),"."]})]})})}function gt(){const{t}=f();return e.jsx(v,{children:e.jsxs(A,{className:"border border-tertiary",children:[e.jsx(k,{width:68,height:46}),e.jsx("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:e.jsx("h1",{className:"text-2xl font-bold",children:t(o.AUTH$LOGGING_BACK_IN)})})]})})}function Nt({onClose:t}){const{t:n}=f(),{mutate:s}=Z(),a=async r=>{r.preventDefault();const c=new FormData(r.currentTarget).get("analytics")==="on";s({user_consents_to_analytics:c},{onSuccess:()=>{oe(c),t()}})};return e.jsx(v,{children:e.jsx("form",{"data-testid":"user-capture-consent-form",onSubmit:a,className:"flex flex-col gap-2",children:e.jsxs(A,{className:"border border-tertiary",children:[e.jsx($,{title:n(o.ANALYTICS$TITLE)}),e.jsx(Q,{children:n(o.ANALYTICS$DESCRIPTION)}),e.jsxs("label",{className:"flex gap-2 items-center self-start",children:[e.jsx("input",{name:"analytics",type:"checkbox",defaultChecked:!0}),n(o.ANALYTICS$SEND_ANONYMOUS_DATA)]}),e.jsx(I,{testId:"confirm-preferences",type:"submit",variant:"primary",className:"w-full",children:n(o.ANALYTICS$CONFIRM_PREFERENCES)})]})})})}const It=()=>{const{mutate:t}=Z();return{migrateUserConsent:u.useCallback(async s=>{const a=localStorage.getItem("analytics-consent");a&&(s?.handleAnalyticsWasPresentInLocalStorage(),await t({user_consents_to_analytics:a==="true"},{onSuccess:()=>{oe(a==="true")}}),localStorage.removeItem("analytics-consent"))},[])}};function vt(){const{t}=f(),{mutate:n,isPending:s}=G({mutationFn:j.createBillingSessionResponse,onSuccess:a=>{window.location.href=a},onError:()=>{ae(t(o.BILLING$ERROR_WHILE_CREATING_SESSION))}});return e.jsx(v,{children:e.jsxs(A,{className:"border border-tertiary",children:[e.jsx(k,{width:68,height:46}),e.jsxs("div",{className:"flex flex-col gap-2 w-full items-center text-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:t(o.BILLING$YOUVE_GOT_50)}),e.jsx("p",{children:e.jsx($e,{i18nKey:"BILLING$CLAIM_YOUR_50",components:{b:e.jsx("strong",{})}})})]}),e.jsx(I,{testId:"proceed-to-stripe-button",type:"submit",variant:"primary",className:"w-full",isDisabled:s,onClick:n,children:t(o.BILLING$PROCEED_TO_STRIPE)})]})})}const St=()=>{const{data:t,isLoading:n}=M(),{data:s,isLoading:a}=U(),r=De(),l=L({appMode:t?.APP_MODE||null,identityProvider:"github"}),c=L({appMode:t?.APP_MODE||null,identityProvider:"gitlab"}),h=L({appMode:t?.APP_MODE||null,identityProvider:"bitbucket"});d.useEffect(()=>{if(t?.APP_MODE!=="saas"||n||a||s||!r)return;let i=null;if(r===D.GITHUB?i=l:r===D.GITLAB?i=c:r===D.BITBUCKET&&(i=h),i){const p=new URL(i);p.searchParams.append("login_method",r),window.location.href=p.toString()}},[t?.APP_MODE,s,n,a,r,l,c,h])},_t=()=>{const t=y(),{data:n,isLoading:s}=U(),{data:a}=M(),r=P();d.useEffect(()=>{if(a?.APP_MODE!=="saas"||s||!n)return;const l=new URLSearchParams(t.search),c=l.get("login_method");if(Object.values(D).includes(c)){Pe(c),l.delete("login_method");const h=`${t.pathname}${l.toString()?`?${l.toString()}`:""}`;r(h,{replace:!0})}},[n,s,t.search,a?.APP_MODE])};function At({children:t}){const{data:n,isLoading:s}=Y(),a=P(),{pathname:r}=y();return u.useEffect(()=>{s||n?.EMAIL_VERIFIED===!1&&r!=="/settings/user"&&a("/settings/user",{replace:!0})},[n?.EMAIL_VERIFIED,r,a,s]),t}const Os=ue(function(){const n=he(),{t:s}=f();return pe(n)?e.jsxs("div",{children:[e.jsx("h1",{children:n.status}),e.jsx("p",{children:n.statusText}),e.jsx("pre",{children:n.data instanceof Object?JSON.stringify(n.data):n.data})]}):n instanceof Error?e.jsxs("div",{children:[e.jsx("h1",{children:s(o.ERROR$GENERIC)}),e.jsx("pre",{children:n.message})]}):e.jsx("div",{children:e.jsx("h1",{children:s(o.ERROR$UNKNOWN)})})}),Ls=me(function(){const n=P(),{pathname:s}=y(),a=Ee(),{data:r}=Y(),{error:l}=Ue(),{migrateUserConsent:c}=It(),{t:h}=f(),i=M(),{data:p,isFetching:C,isError:x}=U(),g=Be({appMode:i.data?.APP_MODE||null,gitHubClientId:i.data?.GITHUB_CLIENT_ID||null}),N=a?null:g,[E,T]=u.useState(!1);St(),_t(),u.useEffect(()=>{!a&&r?.LANGUAGE&&ke.changeLanguage(r.LANGUAGE)},[r?.LANGUAGE,a]),u.useEffect(()=>{if(!a){const O=r?.USER_CONSENTS_TO_ANALYTICS===null;T(O)}},[r,a]),u.useEffect(()=>{a||c({handleAnalyticsWasPresentInLocalStorage:()=>{T(!1)}})},[a]),u.useEffect(()=>{r?.IS_NEW_USER&&i.data?.APP_MODE==="saas"&&ne(h(o.BILLING$YOURE_IN))},[r?.IS_NEW_USER,i.data?.APP_MODE]),u.useEffect(()=>{!a&&l?.status===402&&s!=="/"&&n("/")},[l?.status,s,a]);const S=u.useCallback(()=>typeof window<"u"&&window.localStorage?localStorage.getItem(X.LOGIN_METHOD)!==null:!1,[]),[w,b]=u.useState(S());u.useEffect(()=>{const O=V=>{V.key===X.LOGIN_METHOD&&b(S())},R=()=>{b(S())};return window.addEventListener("storage",O),window.addEventListener("focus",R),()=>{window.removeEventListener("storage",O),window.removeEventListener("focus",R)}},[S]),u.useEffect(()=>{b(S())},[p,S]);const B=!p&&!x&&!C&&!a&&i.data?.APP_MODE==="saas"&&!w,F=!p&&!x&&!C&&!a&&i.data?.APP_MODE==="saas"&&w;return e.jsxs("div",{"data-testid":"root-layout",className:"bg-base p-3 h-screen lg:min-w-[1024px] flex flex-col md:flex-row gap-3",children:[e.jsx(ht,{}),e.jsx("div",{id:"root-outlet",className:"h-[calc(100%-50px)] md:h-full w-full relative overflow-auto",children:e.jsx(At,{children:e.jsx(fe,{})})}),B&&e.jsx(Ct,{githubAuthUrl:N,appMode:i.data?.APP_MODE,providersConfigured:i.data?.PROVIDERS_CONFIGURED}),F&&e.jsx(gt,{}),i.data?.APP_MODE==="oss"&&E&&e.jsx(Nt,{onClose:()=>{T(!1)}}),i.data?.FEATURE_FLAGS.ENABLE_BILLING&&i.data?.APP_MODE==="saas"&&r?.IS_NEW_USER&&e.jsx(vt,{})]})});export{Os as ErrorBoundary,Ls as default};
