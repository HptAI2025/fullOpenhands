import{w as _,R as N,r as l,j as t}from"./chunk-C37GKA54-qdDtUwSj.js";import{u as R}from"./react-redux-BK5-gECc.js";import{I as a}from"./declaration-kTjv-WkO.js";import{R as h}from"./agent-state-B-zEstf9.js";import{u as S}from"./useQuery-Cjjz7Wuw.js";import{O as y}from"./open-hands-DRsomnks.js";import{u as w}from"./use-conversation-id-Cpxdv6Lo.js";import{t as O}from"./vscode-url-helper-5Tt6LlE2.js";import{u as T}from"./use-runtime-is-ready-CBSkLmp_.js";import{u as c}from"./useTranslation-CSvjoMys.js";import"./open-hands-axios-BhCWnLeu.js";import"./use-active-conversation-BkcNKr5c.js";import"./i18nInstance-DBIXdvxg.js";const C=()=>{const{t:e}=c(),{conversationId:r}=w(),o=T();return S({queryKey:["vscode_url",r],queryFn:async()=>{if(!r)throw new Error("No conversation ID");const s=await y.getVSCodeUrl(r);return s.vscode_url?{url:O(s.vscode_url),error:null}:{url:null,error:e(a.VSCODE$URL_NOT_AVAILABLE)}},enabled:o&&!!r,refetchOnMount:!0,retry:3})};function g(e,r=!1){try{const o=localStorage.getItem(`FEATURE_${e}`)||r.toString();return!!JSON.parse(o)}catch{return r}}const v=()=>g("VSCODE_IN_NEW_TAB");function A(){const{t:e}=c(),{data:r,isLoading:o,error:s}=C(),{curAgentState:u}=R(n=>n.agent),f=h.includes(u),m=N.useRef(null),[d,x]=l.useState(!1),[i,E]=l.useState(null);l.useEffect(()=>{if(r?.url)try{const n=new URL(r.url).protocol,p=window.location.protocol;x(v()||n!==p)}catch{E(e("VSCODE$URL_PARSE_ERROR"))}},[r?.url]);const I=()=>{r?.url&&window.open(r.url,"_blank","noopener,noreferrer")};return f?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:e("DIFF_VIEWER$WAITING_FOR_RUNTIME")}):o?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:e("DIFF_VIEWER$WAITING_FOR_RUNTIME")}):s||r&&r.error||!r?.url||i?t.jsx("div",{className:"w-full h-full flex items-center text-center justify-center text-2xl text-tertiary-light",children:i||r?.error||String(s)||e(a.VSCODE$URL_NOT_AVAILABLE)}):d?t.jsxs("div",{className:"w-full h-full flex flex-col items-center justify-center gap-4",children:[t.jsx("div",{className:"text-xl text-tertiary-light text-center max-w-md",children:e("VSCODE$CROSS_ORIGIN_WARNING")}),t.jsx("button",{type:"button",onClick:I,className:"px-4 py-2 bg-primary text-white rounded-sm hover:bg-primary-dark transition-colors",children:e("VSCODE$OPEN_IN_NEW_TAB")})]}):t.jsx("div",{className:"h-full w-full",children:t.jsx("iframe",{ref:m,title:e(a.VSCODE$TITLE),src:r.url,className:"w-full h-full border-0",allow:"clipboard-read; clipboard-write"})})}const k=_(A);export{k as default};
